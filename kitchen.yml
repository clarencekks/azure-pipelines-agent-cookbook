---
driver:
  name: vagrant
  box_check_update: true
  customize:
    cpus: 8
    memory: 8092

provisioner:
  product_name: chef
  product_version: 14
  install_strategy: always

verifier:
  name: inspec
  reporter:
    - cli
    - junit:/tmp/%{suite}-%{platform}-inspec.xml
  inspec_tests:
    - test/integration/default

platforms:
  - name: debian8
    driver:
      box: debian/jessie64

  - name: debian9
    driver:
      box: debian/stretch64

  - name: ubuntu1604
    driver:
      box: ubuntu/xenial64

  - name: ubuntu1710
    driver:
      box: ubuntu/artful64

  - name: ubuntu1804
    driver:
      box: ubuntu/bionic64

  - name: centos7
    driver:
      box: centos/7

  - name: windows-2016
    driver:
      box: StefanScherer/windows_2016
      communicator: 'winrm'
      gui: true

  # The following platforms are private boxes and are not available from the vagrant box repository
  # Follow instructions provided in TESTING.md to create a box

  # To a use a private box:
  # 1. Create a box. To do so, follow the instructions in TESTING.md
  # 2. Once you've added the vagrant box, modify this file to use it
  # 3. In the 'suites' section of this file, list your box name(s) under 'includes' for the corresponding platform
  # 4. Confirm your box shows up when running `vagrant box list` and `kitchen list` when in this cookbook directory

  - name: macos-mojave
    driver:
      box: microsoft/macos-mojave

  - name: windows10
    driver:
      guest: windows
      communicator: 'winrm'
      box: win10x64-enterprise

  - name: windows-2012-r2
    driver:
      guest: windows
      communicator: 'winrm'
      box: windows-2012-r2

suites:
  - name: windows-basic
    run_list:
      - recipe[windows-basic::default]
    includes:
      - windows10
      - windows-2012-r2
      - windows-2016
    attributes:
      vsts_agent_test:
        username: <%= ENV['BOX_USERNAME'] %>
        vsts_url: <%= ENV['VSTS_URL'] %>
        vsts_pool: <%= ENV['VSTS_POOL'] %>
        vsts_token: <%= ENV['VSTS_TOKEN'] %>
        deployment_group_name: <%= ENV['VSTS_DEPLOYMENT_GROUP_NAME'] %>
        deployment_group_project: <%= ENV['VSTS_DEPLOYMENT_GROUP_PROJECT'] %>

  - name: linux-basic
    run_list:
      - recipe[linux-basic::default]
    includes:
      - debian8
      - debian9
      - ubuntu1604
      - ubuntu1710
      - ubuntu1804
      - centos7

    attributes:
      vsts_agent_test:
        username: <%= ENV['BOX_USERNAME'] %>
        vsts_url: <%= ENV['VSTS_URL'] %>
        vsts_pool: <%= ENV['VSTS_POOL'] %>
        vsts_token: <%= ENV['VSTS_TOKEN'] %>
        deployment_group_name: <%= ENV['VSTS_DEPLOYMENT_GROUP_NAME'] %>
        deployment_group_project: <%= ENV['VSTS_DEPLOYMENT_GROUP_PROJECT'] %>

  - name: macos-basic
    run_list:
      - recipe[macos-basic::default]
    includes:
      - macos-mojave

    attributes:
      vsts_agent_test:
        username: <%= ENV['BOX_USERNAME'] %>
        vsts_url: <%= ENV['VSTS_URL'] %>
        vsts_pool: <%= ENV['VSTS_POOL'] %>
        vsts_token: <%= ENV['VSTS_TOKEN'] %>
